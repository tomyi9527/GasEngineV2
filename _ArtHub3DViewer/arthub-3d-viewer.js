var GasEngine;GasEngine=(()=>{"use strict";var e={307:(e,t,a)=>{a.d(t,{default:()=>f});const i=class{constructor(e={}){this._iframe=e.iframe,this._name=e.name,this._id=e.id,this._parentEntityId=e.parentEntityId,this._callbacks=new Map}get name(){return this._name}get id(){return this._id}get parentEntityId(){return this._parentEntityId}_invokeIFrame(e,t){if(this._iframe){window.invokeID+=1;let a=window.invokeID;return this._iframe.contentWindow.postMessage({invokeID:a,cmd:e,parameters:t},"*"),new Promise(((t,i)=>{const n=setTimeout((function(){window.removeEventListener("message",s),i({invokeID:a,cmd:e})}),2e5),s=function(i){i.data.invokeID===a&&i.data.cmd===e&&(window.removeEventListener("message",s),clearTimeout(n),t(i.data.parameters))};window.addEventListener("message",s,!1)}))}}_callbackHandlerAdaptor(e){-1===e.data.invokeID&&this._callbackIFrame(e.data.cmd,e.data.parameters)}_callbackIFrame(e,t){const a=this._callbacks.get(e);e&&e.length>0&&void 0!==a&&(Array.isArray(a)?a.forEach((e=>e(t))):a(t))}addCallback(e,t){if(this._callbacks&&e&&t)if(this._callbacks.has(e)){const a=this._callbacks.get(e);Array.isArray(a)?a.push(t):this._callbacks.set(e,[a,t])}else this._callbacks.set(e,t)}removeCallback(e){this._callbacks&&e&&this._callbacks.delete(e)}addEventHandler(){window.addEventListener("message",this._callbackHandlerAdaptor.bind(this),!1)}removeEventHandler(){window.removeEventListener("message",this._callbackHandlerAdaptor),this._callbacks.clear()}},n=[{id:"01_attic_room_with_windows",name:"01_attic_room_with_windows",url:"system/backgroundCubes/01_attic_room_with_windows/thumbnail.jpg"},{id:"02_Ferry_To_Stockholm",name:"02_Ferry_To_Stockholm",url:"system/backgroundCubes/02_Ferry_To_Stockholm/thumbnail.jpg"},{id:"03_HDRI_Sky_1553",name:"03_HDRI_Sky_1553",url:"system/backgroundCubes/03_HDRI_Sky_1553/thumbnail.jpg"},{id:"04_Empty_Night_Side_Walk_In_Small_Town",name:"04_Empty_Night_Side_Walk_In_Small_Town",url:"system/backgroundCubes/04_Empty_Night_Side_Walk_In_Small_Town/thumbnail.jpg"},{id:"05_Stairs_At_Church",name:"05_Stairs_At_Church",url:"system/backgroundCubes/05_Stairs_At_Church/thumbnail.jpg"},{id:"06_The_Interior_Of_The_Romanesque_Rotunda",name:"06_The_Interior_Of_The_Romanesque_Rotunda",url:"system/backgroundCubes/06_The_Interior_Of_The_Romanesque_Rotunda/thumbnail.jpg"},{id:"07_Wooden_Pier_At_Morning",name:"07_Wooden_Pier_At_Morning",url:"system/backgroundCubes/07_Wooden_Pier_At_Morning/thumbnail.jpg"},{id:"08_Winter_Night_Hill",name:"08_Winter_Night_Hill",url:"system/backgroundCubes/08_Winter_Night_Hill/thumbnail.jpg"},{id:"09_Glazed_Patio",name:"09_Glazed_Patio",url:"system/backgroundCubes/09_Glazed_Patio/thumbnail.jpg"},{id:"10_Small_Waterfall_In_Park",name:"10_Small_Waterfall_In_Park",url:"system/backgroundCubes/10_Small_Waterfall_In_Park/thumbnail.jpg"},{id:"11_Morning_On_The_SquareIn_Resort_Town",name:"11_Morning_On_The_SquareIn_Resort_Town",url:"system/backgroundCubes/11_Morning_On_The_SquareIn_Resort_Town/thumbnail.jpg"},{id:"12_Small_Apartment",name:"12_Small_Apartment",url:"system/backgroundCubes/12_Small_Apartment/thumbnail.jpg"},{id:"13_Abandoned_Sanatorium",name:"13_Abandoned_Sanatorium",url:"system/backgroundCubes/13_Abandoned_Sanatorium/thumbnail.jpg"},{id:"14_Blue_Hour_At_Pier",name:"14_Blue_Hour_At_Pier",url:"system/backgroundCubes/14_Blue_Hour_At_Pier/thumbnail.jpg"},{id:"15_Urban_Exploring_Interior",name:"15_Urban_Exploring_Interior",url:"system/backgroundCubes/15_Urban_Exploring_Interior/thumbnail.jpg"}],s=[0,50],r=class extends i{constructor(e){super(e)}_setEnvironment(e){return this._invokeIFrame("setEnvironmentInfo",e)}_getIntensityValueByPercent(e){return(s[1]-s[0])*e/100+s[0]}_getPercentByIntensityValue(e){return 100*(e-s[0])/(s[1]-s[0])}_getOrientationValueByPercent(e){return Math.round(360*e/100)}_getPercentByOrientationValue(e){return Math.round(e/360*100)}_setBackground(e){return this._invokeIFrame("setBackground",e)}getEnvironmentInfo(){return this._invokeIFrame("getEnvironmentInfo").then((e=>(e.intensity=this._getPercentByIntensityValue(e.intensity),e.environmentObj=n.find((t=>t.id===e.environmentName)),e.orientation=this._getPercentByOrientationValue(e.orientation),e)))}set environmentName(e){this._setEnvironment({environmentName:e})}set intensity(e){const t=this._getIntensityValueByPercent(e);this._setEnvironment({intensity:t}),this._setBackground({lightBrightness:t})}set orientation(e){const t=this._getOrientationValueByPercent(e);this._setEnvironment({orientation:t})}getEnvironmentList(){return this._invokeIFrame("getRootDirectory").then((e=>{const t=[...n];return t.forEach((t=>t.url=`${e}${t.url}`)),Promise.resolve(t)}))}};function o(e){var t=e.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var a="#",i=1;i<4;i+=1)a+=t.slice(i,i+1).concat(t.slice(i,i+1));t=a}var n=[];for(i=1;i<7;i+=2)n.push(parseInt("0x"+t.slice(i,i+2))/255);return n}return t}function l(e){if(!e)return"";const{r:t,g:a,b:i}=e;let n=[t,a,i],s="#";for(var r=0;r<3;r++)s+=("0"+Math.round(255*Number(n[r])).toString(16)).slice(-2);return s}const h=[{id:"SYSTEM_DARK_1.jpg",name:"磨砂黑",url:"system/backgroundImages/SYSTEM_DARK_1.jpg"},{id:"SYSTEM_DARK_2.jpg",name:"经典黑",url:"system/backgroundImages/SYSTEM_DARK_2.jpg"},{id:"SYSTEM_DARK_3.jpg",name:"金属黑",url:"system/backgroundImages/SYSTEM_DARK_3.jpg"},{id:"SYSTEM_GRAY_1.jpg",name:"磨砂灰",url:"system/backgroundImages/SYSTEM_GRAY_1.jpg"},{id:"SYSTEM_GRAY_2.jpg",name:"经典灰",url:"system/backgroundImages/SYSTEM_GRAY_2.jpg"},{id:"SYSTEM_LIGHT_GRAY.jpg",name:"浅灰",url:"system/backgroundImages/SYSTEM_LIGHT_GRAY.jpg"},{id:"SYSTEM_METAL.jpg",name:"金属银",url:"system/backgroundImages/SYSTEM_METAL.jpg"},{id:"SYSTEM_LIGHT_BLUE.jpg",name:"深蓝",url:"system/backgroundImages/SYSTEM_LIGHT_BLUE.jpg"}],m=[0,2],u=class extends i{constructor(e){super(e)}_setBackground(e){return this._invokeIFrame("setBackground",e)}_getEnvironmentBrightnessValueByPercent(e){return(m[1]-m[0])*e/100+m[0]}_getPercentByEnvironmentBrightnessValue(e){return 100*(e-m[0])/(m[1]-m[0])}getBackgroundInfo(){return this._invokeIFrame("getBackgroundInfo").then((e=>(e.environmentBrightness=this._getPercentByEnvironmentBrightnessValue(e.environmentBrightness),e.backgroundImageObj=h.find((t=>t.id===e.backgroundImage)),e.backgroundColor=l(e.backgroundColor),e)))}set type(e){this._setBackground({type:e})}set backgroundColor(e){const t=o(e);this._setBackground({backgroundColor:{r:t[0],g:t[1],b:t[2]}})}set backgroundImage(e){this._setBackground({backgroundImage:e})}set cubeMapName(e){this._setBackground({cubeMapName:e})}set lightEnable(e){this._setBackground({lightEnable:e})}set environmentBrightness(e){const t=this._getEnvironmentBrightnessValueByPercent(e);this._setBackground({environmentBrightness:t})}set orientation(e){const t=Math.round(360*e/100);this._setBackground({orientation:t})}set environmentBlur(e){this._setBackground({environmentBlur:e})}getBackgroundImageList(){return this._invokeIFrame("getRootDirectory").then((e=>{const t=[...h];return t.forEach((t=>t.url=`${e}${t.url}`)),Promise.resolve(t)}))}},_=class extends i{constructor(e){super(e)}hide(){return this._invokeIFrame("showMesh",{id:this.parentEntityId,visible:!1})}show(){return this._invokeIFrame("showMesh",{id:this.parentEntityId,visible:!0})}getUVData(){return this._invokeIFrame("getMeshUVData",this.id).then((e=>e))}},p=["albedoMapName","metalnessMapName","specularF0MapName","roughnessMapName","glossinessMapName","normalMapName","aoMapName","cavityMapName","opacityMapName","emissiveMapName"],c=["albedoMapName","specularMapName","roughnessMapName","glossinessMapName","normalMapName","aoMapName","cavityMapName","opacityMapName","emissiveMapName"],d=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},g=["albedoMap","specularMap","metalnessMap","specularF0Map","roughnessMap","glossinessMap","normalMap","aoMap","cavityMap","opacityMap","emissiveMap"],v=class extends i{constructor(e){super(e),this._type=e.type,this._invokeFunctionField("enableMaterialBasicProperties"),this._materialContexts=new Map}init(){return new Promise(((e,t)=>{let a=this.type;"compound"===this.type?this.activeMaterialType.then((t=>{this.setMaterialContext(t),e()})):(this.setMaterialContext(a),e())}))}_invokeGetField(e){return this._invokeFunctionField("get"+d(e))}_invokeSetField(e,t){return this._invokeFunctionField("set"+d(e),t)}_invokeFunctionField(e,t){return this._invokeIFrame("invokeMaterialField",{field:e,id:this.id,value:t}).catch((e=>console.log(e)))}get type(){return this._type}get materialTypes(){return this._invokeGetField("materialTypes")}get activeMaterialType(){return this._invokeGetField("activeMaterialType")}set activeMaterialType(e){return this.setMaterialContext(e),this._invokeSetField("activeMaterialType",e)}get culling(){return this._invokeGetField("culling")}set culling(e){return this._invokeSetField("culling",e)}get albedoEnable(){return this._invokeGetField("albedoEnable")}get albedoColor(){return this._invokeGetField("albedoColor")}get albedoFactor(){return this._invokeGetField("albedoFactor")}get albedoMapPath(){return this._invokeGetField("albedoMapPath")}get albedoMapImage(){return this._invokeGetField("albedoMapImage")}get specularEnable(){return this._invokeGetField("specularEnable")}get specularColor(){return this._invokeGetField("specularColor")}get specularFactor(){return this._invokeGetField("specularFactor")}get specularMapPath(){return this._invokeGetField("specularMapPath")}get specularMapImage(){return this._invokeGetField("specularMapImage")}get metalnessEnable(){return this._invokeGetField("metalnessEnable")}get metalnessFactor(){return this._invokeGetField("metalnessFactor")}get metalnessMapPath(){return this._invokeGetField("metalnessMapPath")}get metalnessMapImage(){return this._invokeGetField("metalnessMapImage")}get specularF0Enable(){return this._invokeGetField("specularF0Enable")}get specularF0Factor(){return this._invokeGetField("specularF0Factor")}get specularF0MapPath(){return this._invokeGetField("specularF0MapPath")}get specularF0MapImage(){return this._invokeGetField("specularF0MapImage")}get roughnessEnable(){return this._invokeGetField("roughnessEnable")}get roughnessFactor(){return this._invokeGetField("roughnessFactor")}get roughnessMapPath(){return this._invokeGetField("roughnessMapPath")}get roughnessMapImage(){return this._invokeGetField("roughnessMapImage")}get glossinessEnable(){return this._invokeGetField("glossinessEnable")}get glossinessFactor(){return this._invokeGetField("glossinessFactor")}get glossinessMapPath(){return this._invokeGetField("glossinessMapPath")}get glossinessMapImage(){return this._invokeGetField("glossinessMapImage")}get normalEnable(){return this._invokeGetField("normalEnable")}get normalFactor(){return this._invokeGetField("normalFactor")}get normalFlipY(){return this._invokeGetField("normalFlipY")}get normalMapPath(){return this._invokeGetField("normalMapPath")}get normalMapImage(){return this._invokeGetField("normalMapImage")}get aoEnable(){return this._invokeGetField("aoEnable")}get aoFactor(){return this._invokeGetField("aoFactor")}get aoMapPath(){return this._invokeGetField("aoMapPath")}get aoMapImage(){return this._invokeGetField("aoMapImage")}get aoOccludeSpecular(){return this._invokeGetField("aoOccludeSpecular")}get cavityEnable(){return this._invokeGetField("cavityEnable")}get cavityFactor(){return this._invokeGetField("cavityFactor")}get cavityMapPath(){return this._invokeGetField("cavityMapPath")}get cavityMapImage(){return this._invokeGetField("cavityMapImage")}get opacityEnable(){return this._invokeGetField("opacityEnable")}get opacityFactor(){return this._invokeGetField("opacityFactor")}get opacityMapPath(){return this._invokeGetField("opacityMapPath")}get opacityMapImage(){return this._invokeGetField("opacityMapImage")}get opacityAlphaInvert(){return this._invokeGetField("opacityAlphaInvert")}get emissiveEnable(){return this._invokeGetField("emissiveEnable")}get emissiveColor(){return this._invokeGetField("emissiveColor")}get emissiveMapPath(){return this._invokeGetField("emissiveMapPath")}get emissiveMapImage(){return this._invokeGetField("emissiveMapImage")}get emissiveFactor(){return this._invokeGetField("emissiveFactor")}set albedoEnable(e){this._invokeSetField("albedoEnable",e)}set albedoColor(e){this._invokeSetField("albedoColor",e)}set albedoFactor(e){e/=100,this._invokeSetField("albedoFactor",e)}set specularEnable(e){this._invokeSetField("specularEnable",e)}set specularColor(e){this._invokeSetField("specularColor",e)}set specularFactor(e){e/=100,this._invokeSetField("specularFactor",e)}set metalnessEnable(e){this._invokeSetField("metalnessEnable",e)}set metalnessFactor(e){e/=100,this._invokeSetField("metalnessFactor",e)}set specularF0Enable(e){this._invokeSetField("specularF0Enable",e)}set specularF0Factor(e){e/=100,this._invokeSetField("specularF0Factor",e)}set roughnessEnable(e){this._invokeSetField("roughnessEnable",e)}set roughnessFactor(e){e/=100,this._invokeSetField("roughnessFactor",e)}set glossinessEnable(e){this._invokeSetField("glossinessEnable",e)}set glossinessFactor(e){e/=100,this._invokeSetField("glossinessFactor",e)}set normalEnable(e){this._invokeSetField("normalEnable",e)}set normalFactor(e){e/=100,this._invokeSetField("normalFactor",e)}set normalFlipY(e){this._invokeSetField("normalFlipY",e)}set aoEnable(e){this._invokeSetField("aoEnable",e)}set aoFactor(e){e/=100,this._invokeSetField("aoFactor",e)}set aoOccludeSpecular(e){this._invokeSetField("aoOccludeSpecular",e)}set cavityEnable(e){this._invokeSetField("cavityEnable",e)}set cavityFactor(e){e/=100,this._invokeSetField("cavityFactor",e)}set opacityEnable(e){this._invokeSetField("opacityEnable",e)}set opacityFactor(e){e/=100,this._invokeSetField("opacityFactor",e)}set opacityAlphaInvert(e){this._invokeSetField("opacityAlphaInvert",e)}set emissiveEnable(e){this._invokeSetField("emissiveEnable",e)}set emissiveColor(e){this._invokeSetField("emissiveColor",e)}set emissiveFactor(e){this._invokeSetField("emissiveFactor",e)}get highlightMaskEnable(){return this._invokeGetField("highlightMaskEnable")}set highlightMaskEnable(e){this._invokeSetField("highlightMaskEnable",e)}get highlightMaskColor(){return this._invokeGetField("highlightMaskColor")}set highlightMaskColor(e){this._invokeSetField("highlightMaskColor",e)}get highlightMaskAlpha(){return this._invokeGetField("highlightMaskAlpha")}set highlightMaskAlpha(e){this._invokeSetField("highlightMaskAlpha",e)}set albedoMapPath(e){this._invokeSetField("albedoMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.albedoMapName=e[0]))}set specularMapPath(e){this._invokeSetField("specularMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.specularMapName=e[0]))}set metalnessMapPath(e){this._invokeSetField("metalnessMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.metalnessMapName=e[0]))}set specularF0MapPath(e){this._invokeSetField("specularF0MapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.specularF0MapName=e[0]))}set roughnessMapPath(e){this._invokeSetField("roughnessMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.roughnessMapName=e[0]))}set glossinessMapPath(e){this._invokeSetField("roughnessMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.glossinessMapName=e[0]))}set normalMapPath(e){this._invokeSetField("normalMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.normalMapName=e[0]))}set aoMapPath(e){this._invokeSetField("aoMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.aoMapName=e[0]))}set cavityMapPath(e){this._invokeSetField("cavityMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.cavityMapName=e[0]))}set opacityMapPath(e){this._invokeSetField("opacityMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.opacityMapName=e[0]))}set emissiveMapPath(e){this._invokeSetField("emissiveMapPath",e),this._invokeIFrame("getTextureName",[e]).then((e=>this.emissiveMapName=e[0]))}set albedoMapImage(e){this._invokeSetField("albedoMapImage",e)}set specularMapImage(e){this._invokeSetField("specularMapImage",e)}set metalnessMapImage(e){this._invokeSetField("metalnessMapImage",e)}set specularF0MapImage(e){this._invokeSetField("specularF0MapImage",e)}set roughnessMapImage(e){this._invokeSetField("roughnessMapImage",e)}set glossinessMapImage(e){this._invokeSetField("roughnessMapImage",e)}set normalMapImage(e){this._invokeSetField("normalMapImage",e)}set aoMapImage(e){this._invokeSetField("aoMapImage",e)}set cavityMapImage(e){this._invokeSetField("cavityMapImage",e)}set opacityMapImage(e){this._invokeSetField("opacityMapImage",e)}set emissiveMapImage(e){this._invokeSetField("emissiveMapImage",e)}setAlbedoMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.albedoMapName=e[0])),this._invokeFunctionField("setAlbedoMapPath",e)])}setSpecularMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.specularMapName=e[0])),this._invokeFunctionField("setSpecularMapPath",e)])}setMetalnessMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.metalnessMapName=e[0])),this._invokeFunctionField("setMetalnessMapPath",e)])}setSpecularF0MapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.specularF0MapName=e[0])),this._invokeFunctionField("setSpecularF0MapPath",e)])}setRoughnessMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.roughnessMapName=e[0])),this._invokeFunctionField("setRoughnessMapPath",e)])}setGlossinessMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.glossinessMapName=e[0])),this._invokeFunctionField("setGlossinessMapPath",e)])}setNormalMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.normalMapName=e[0])),this._invokeFunctionField("setNormalMapPath",e)])}setAoMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.aoMapName=e[0])),this._invokeFunctionField("setAoMapPath",e)])}setCavityMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.cavityMapName=e[0])),this._invokeFunctionField("setCavityMapPath",e)])}setOpacityMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.opacityMapName=e[0])),this._invokeFunctionField("setOpacityMapPath",e)])}setEmissiveMapPath(e){return Promise.all([this._invokeIFrame("getTextureName",[e]).then((e=>this.emissiveMapName=e[0])),this._invokeFunctionField("setEmissiveMapPath",e)])}setAlbedoMapImage(e){return this._invokeFunctionField("setAlbedoMapImage",e)}setSpecularMapImage(e){return this._invokeFunctionField("setSpecularMapImage",e)}setMetalnessMapImage(e){return this._invokeFunctionField("setMetalnessMapImage",e)}setSpecularF0MapImage(e){return this._invokeFunctionField("setSpecularF0MapImage",e)}setRoughnessMapImage(e){return this._invokeFunctionField("setRoughnessMapImage",e)}setGlossinessMapImage(e){return this._invokeFunctionField("setGlossinessMapImage",e)}setNormalMapImage(e){return this._invokeFunctionField("setNormalMapImage",e)}setAoMapImage(e){return this._invokeFunctionField("setAoMapImage",e)}setCavityMapImage(e){return this._invokeFunctionField("setCavityMapImage",e)}setOpacityMapImage(e){return this._invokeFunctionField("setOpacityMapImage",e)}setEmissiveMapImage(e){return this._invokeFunctionField("setEmissiveMapImage",e)}setMaterialContext(e){this._materialContexts.get(e)||this._materialContexts.set(e,{}),this._activeContext=this._materialContexts.get(e)}get albedoMapName(){return this._activeContext._albedoMapName}get specularMapName(){return this._activeContext._specularMapName}get metalnessMapName(){return this._activeContext._metalnessMapName}get specularF0MapName(){return this._activeContext._specularF0MapName}get roughnessMapName(){return this._activeContext._roughnessMapName}get glossinessMapName(){return this._activeContext._roughnessMapName}get normalMapName(){return this._activeContext._normalMapName}get aoMapName(){return this._activeContext._aoMapName}get cavityMapName(){return this._activeContext._cavityMapName}get opacityMapName(){return this._activeContext._opacityMapName}get emissiveMapName(){return this._activeContext._emissiveMapName}set albedoMapName(e){this._activeContext._albedoMapName=e}set specularMapName(e){this._activeContext._specularMapName=e}set metalnessMapName(e){this._activeContext._metalnessMapName=e}set specularF0MapName(e){this._activeContext._specularF0MapName=e}set roughnessMapName(e){this._activeContext._roughnessMapName=e}set glossinessMapName(e){this._activeContext._roughnessMapName=e}set normalMapName(e){this._activeContext._normalMapName=e}set aoMapName(e){this._activeContext._aoMapName=e}set cavityMapName(e){this._activeContext._cavityMapName=e}set opacityMapName(e){this._activeContext._opacityMapName=e}set emissiveMapName(e){this._activeContext._emissiveMapName=e}getMaterialInfo(e){return this._invokeFunctionField("getHelperMaterialInfo",e).then((e=>this.updateNames(e).then((()=>(this._appendAdditionalFieldsToInfo(e),e)))))}get activeMaterialInfo(){return this.activeMaterialType.then((e=>this.getMaterialInfo(e)))}get info(){return this._invokeGetField("helperInfo").then((e=>this.updateNames(e.materialInfo).then((()=>(this._appendAdditionalFieldsToInfo(e.materialInfo),e)))))}_appendAdditionalFieldsToInfo(e){"electric"===e.type?c.forEach((t=>e[t]=this[t])):"dielectric"===e.type&&p.forEach((t=>e[t]=this[t]))}updateNames(e){var t=new Map;g.forEach((a=>{e[`${a}Path`]&&!this[`${a}Name`]&&function(e,a){let i=t.get(e);i?i.push(a):t.set(e,[a])}(e[`${a}Path`],`${a}Name`)}));let a=[];return t.forEach(((e,t)=>{a.push(t)})),this._invokeIFrame("getTextureName",a).then((e=>{for(let i=0;i<a.length;++i)t.get(a[i]).forEach((t=>{this[t]=e[i]}))}))}getInfo(){return Promise.resolve(this.info)}setActiveMaterialType(e){this.activeMaterialType=e}triggerHighlightMask(e=2500,t=.9,a=.6){this.highlightMaskEnable=!0;var i=this;!function({timing:e,draw:t,duration:a}){let i=performance.now();requestAnimationFrame((function n(s){let r=(s-i)/a;r>1&&(r=1);let o=e(r);t(o),r<1&&requestAnimationFrame(n)}))}({duration:e,timing(e){let i=Math.min(Math.max(0,t),.999999),n=1-Math.min(Math.max(0,a),1);return e<i?n:(n-1)/(i-1)*(e-1)+1},draw(e){i.highlightMaskAlpha=1-e}})}getTextureLinkByPath(e){var t=this,a=function(a){var i=[];return g.forEach((n=>{a[`${n}Path`]===e&&i.push({id:t.id,type:a.type,map:n})})),i};return"compound"!==this.type?this.getMaterialInfo().then((e=>a(e))):this.materialTypes.then((e=>{let t=e.map((e=>this.getMaterialInfo(e).then((e=>a(e)))));return Promise.all(t)})).then((e=>{var t=[];return e.forEach((e=>{t=t.concat(e)})),t}))}},k=class extends i{constructor(e){super(e)}get id(){return this._name}},M=class extends i{constructor(e){super(e),this._meshList=[],this._materialList=[],this._animationClips=[]}getModelStructure(){return this._invokeIFrame("getModelStructure",this.id).then((e=>{const t=e.mesh;this._meshList=t.map((e=>new _({iframe:this._iframe,...e})));const a=e.material;this._materialList=a.map((e=>new v({iframe:this._iframe,...e})));const i=e.animationClips;return this._animationClips=i.map((e=>new k({iframe:this._iframe,...e}))),Promise.all(this._materialList.map((e=>e.init()))).then((()=>({name:this.name,id:this.id,...e})))}))}getMeshById(e){let t=this._meshList.findIndex((t=>t.id===e));const a=-1!==t?this._meshList[t]:null;return Promise.resolve(a)}getMaterialById(e){let t=this._materialList.findIndex((t=>t.id===e));const a=-1!==t?this._materialList[t]:null;return Promise.resolve(a)}getMaterialByIndex(e){return e>=0&&e<this._materialList.length?this._materialList[e]:null}getAnimationClipById(e){let t=this._animationClips.findIndex((t=>t.id===e));const a=-1!==t?this._animationClips[t]:null;return Promise.resolve(a)}getMeshList(){return Promise.resolve(this._meshList)}getMaterialList(){return Promise.resolve(this._materialList)}getAnimationClips(){return Promise.resolve(this._animationClips)}deleteAnimationClipById(e){return this._invokeIFrame("deleteAnimationClipById",e).then((()=>{let t=this._animationClips.findIndex((t=>t.id===e));return-1!==t&&this._animationClips.splice(t,1),!0}))}getTextureLinkByPath(e){var t=this._materialList.map((t=>t.getTextureLinkByPath(e)));return Promise.all(t).then((e=>{var t=[];return e.forEach((e=>{t=t.concat(e)})),t}))}addAnimationClips(e){var t=this._model.getScene(),a=t.getModelRoot(),i=a.getComponent("animator");this.addCallback(MessageType.FileLoaded,(e=>{e.count==e.total&&function(){t.getModelRoot().getComponent("animator").takeoutClips().forEach((e=>i.setAnimationClip(e.getName(),e))),this._invokeIFrame("deleteModelByUniqueId",new_root),t.setModelRoot(a)}()})),this._invokeIFrame("load",e)}},F="structureLoaded",I=class extends i{constructor(e){super(e),this.init()}init(){this._environmentalLight=new r({iframe:this._iframe}),this._skybox=new u({iframe:this._iframe}),this._modelList=[],this.addEventHandler()}destroy(){this.removeEventHandler()}loadModel(e){return new Promise(((t,a)=>{this._invokeIFrame("load",e),this.addCallback(F,(()=>{this.removeCallback(F),this.setModelList(),t(!0)}))}))}unloadModel(e){return this._invokeIFrame("deleteCurrentModel")}setModelList(){return this._invokeIFrame("getModels").then((e=>(this._modelList=[],e.forEach((e=>{const t=new M({iframe:this._iframe,...e});this._modelList.push(t)})),this._modelList)))}getEnvironmentalLight(){return Promise.resolve(this._environmentalLight)}getSkybox(){return Promise.resolve(this._skybox)}getModelList(){return Promise.resolve(this._modelList)}getModelById(e){let t=this._modelList.findIndex((t=>t.id===e));return-1!==t?this._modelList[t]:null}deleteModelByUniqueId(e){return this._invokeIFrame("deleteModelByUniqueId",e).then((()=>{let t=this._modelList.findIndex((t=>t.id===e));if(-1===t)return!1;this._modelList.splice(t,1)}))}getTextureList(){return this._invokeIFrame("getTextureList").then((e=>{var t=[];return e.forEach((e=>{t.push(e.path)})),this._invokeIFrame("getTextureName",t).then((a=>{for(let i=0;i<t.length;++i)e[i].name=a[i];return e}))}))}getTextureLinkByPath(e){return this.getModelList().then((t=>{var a=t.map((t=>t.getTextureLinkByPath(e)));return Promise.all(a).then((e=>{var t=[];return e.forEach((e=>{t=t.concat(e)})),t}))}))}removeTextureByPath(e){return this._invokeIFrame("removeTextureByPath",e)}clearTextureList(){return this._invokeIFrame("clearTextureList")}replaceModel(){this._model.getScene().getModelRoot().getComponent("animator"),this._invokeIFrame("load",modelInfo)}},b=[{id:0,name:"正常"},{id:1,name:"基色"},{id:2,name:"法线"},{id:3,name:"光照"},{id:4,name:"金属"}],y=[.1,10],S=class extends i{constructor(e){super(e)}_getScaleByPercent(e){return(y[1]-y[0])*e/100+y[0]}_getPercentByScale(e){return 100*(e-y[0])/(y[1]-y[0])}showTopology(e){return this._invokeIFrame("showTopology",e)}setTopologyColor(e){const t=Array.isArray(e)?e:o(e);return this._invokeIFrame("setTopologyColor",t)}setTopologyAlpha(e){const t=e>0;return this.showTopology(t),this._invokeIFrame("setTopologyAlpha",e/100)}getTopologyColor(){return this._invokeIFrame("getTopologyColor")}getTopologyAlpha(){return this._invokeIFrame("getTopologyAlpha")}showTPose(e){return this._invokeIFrame("showTPose",e)}showSkeleton(e){return this._invokeIFrame("showSkeleton",e)}set skeletonScale(e){const t=this._getScaleByPercent(e);return this._invokeIFrame("setSkeletonScale",t)}setSkeletonScale(e){return this._invokeIFrame("setSkeletonScale",e)}getSkeletonScale(){return this._invokeIFrame("getSkeletonScale")}changeRenderMode(e){return this._invokeIFrame("changeRenderMode",e)}getRendererInfo(){return this._invokeIFrame("getRendererInfo").then((e=>(e.renderModeObj=b.find((t=>t.id===e.renderMode)),e.wireframeColor=l(e.wireframeColor),e.wireframeOpacity=e.wireframeEnable?Math.round(100*e.wireframeOpacity):0,e.skelentorScale=this._getPercentByScale(e.skelentorScale),e)))}},P="inited";window.invokeID=1;class E extends i{constructor(e){super();const{container:t,baseUrl:a}=e;this._container=t,this._baseUrl=a||this._getBaseURL()}_getIframeSrc(){return`//${this._baseUrl}/_ArtHub3DViewer/arthub-3d-viewer-iframe.html`}_getBaseURL(){let e=window.location.pathname;e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,e.length-1));const t=e?e.split("/"):[],a=t.length>=0?t[0]:"";return a?`${window.location.host}/${a}/gas`:`${window.location.host}`}_createIframe(){const e=document.createElement("iframe");return e.id="arthub-3d-viewer",e.style.borderWidth="0px",e.style.width="100%",e.style.height="100%",e}init(){this._iframe=this._createIframe(),this._container&&this._container.appendChild(this._iframe),this.addEventHandler()}destroy(){this._container&&this._iframe&&(this._container.removeChild(this._iframe),this._iframe=null,this._container=null,this.removeEventHandler())}initEngine(e=!1){return new Promise(((t,a)=>{this._iframe.src=this._getIframeSrc(),this.addCallback(P,(i=>{this.removeCallback(P),i?(this._renderer=new S({iframe:this._iframe}),e&&this.initIncrementalSaver(),t(!0)):a(!1)}))}))}destroyEngine(){return this._invokeIFrame("destroyEngine")}createScene(){return this._invokeIFrame("createScene").then((()=>(this._scene=new I({iframe:this._iframe}),this._scene)))}destroyScene(e){return this._invokeIFrame("destroyScene")}getScene(){return Promise.resolve(this._scene)}getRenderer(){return Promise.resolve(this._renderer)}shot(e){return this._invokeIFrame("shot",e)}captureGifStart(){return this._invokeIFrame("captureGifStart")}captureGifStop(){return this._invokeIFrame("captureGifStop")}setAnimationLoopMode(e){return this._invokeIFrame("setAnimationLoopMode",e)}setSpeedFactor(e){return this._invokeIFrame("setSpeedFactor",e)}setClipClamp(e){return this._invokeIFrame("setClipClamp",e)}getAnimationClips(){return this._invokeIFrame("getAnimationClips")}enableAnimation(e){return this._invokeIFrame("enableAnimation",e)}setClipIndex(e){return this._invokeIFrame("setClipIndex",e)}setClipProgress(e){return this._invokeIFrame("setClipProgress",e)}enableHotspotAdd(e){return this._invokeIFrame("enableHotspotAdd",e)}deleteHotspot(e){return this._invokeIFrame("deleteHotspot",e)}getHotspots(){return this._invokeIFrame("getHotspots")}getAssembleConfigurations(){return this._invokeIFrame("getAssembleConfigurations")}initIncrementalSaver(){return this._invokeIFrame("initIncrementalSaver")}saverApplyChange(){return this._invokeIFrame("saverApplyChange").then((e=>{if(e.state)return!0;throw new Error(e.message)}))}}window.ArtHubWebSDK?window.ArtHubWebSDK.ModelViewer=E:window.ArtHubWebSDK={ModelViewer:E};const f={ArtHub3DViewer:E}}},t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,a),n.exports}return a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(307)})().default;